<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>erase_typ_field.ml &mdash; Coverage report</title>
    <meta name="description" content="91.40% coverage in ir_passes/erase_typ_field.ml">
    <link rel="stylesheet" href="../coverage.css"/>
    <script src="../highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div id="header">
      <h1>
        <a href="../index.html">
          <span class="dirname">ir_passes/</span>erase_typ_field.ml
        </a>
      </h1>
      <h2>91.40%</h2>
    </div>
    <div id="navbar">
      <span class="unvisited" style="top:26.24%"></span>
      <span class="unvisited" style="bottom:44.34%"></span>
      <span class="unvisited" style="bottom:43.89%"></span>
      <span class="unvisited" style="bottom:43.44%"></span>
      <span class="unvisited" style="bottom:42.99%"></span>
      <span class="unvisited" style="bottom:41.63%"></span>
      <span class="unvisited" style="bottom:41.18%"></span>
      <span class="unvisited" style="bottom:40.27%"></span>
      <span class="unvisited" style="bottom:39.82%"></span>
      <span class="unvisited" style="bottom:39.37%"></span>
      <span class="unvisited" style="bottom:38.91%"></span>
      <span class="unvisited" style="bottom:38.46%"></span>
      <span class="unvisited" style="bottom:38.01%"></span>
      <span class="unvisited" style="bottom:5.88%"></span>
    </div>
    <div id="report">
      <div id="lines-layer">
        <pre>
<a id="L1"></a><span > </span>
<a id="L2"></a><span > </span>
<a id="L3"></a><span > </span>
<a id="L4"></a><span > </span>
<a id="L5"></a><span > </span>
<a id="L6"></a><span > </span>
<a id="L7"></a><span > </span>
<a id="L8"></a><span > </span>
<a id="L9"></a><span > </span>
<a id="L10"></a><span > </span>
<a id="L11"></a><span > </span>
<a id="L12"></a><span > </span>
<a id="L13"></a><span > </span>
<a id="L14"></a><span > </span>
<a id="L15"></a><span > </span>
<a id="L16"></a><span > </span>
<a id="L17"></a><span > </span>
<a id="L18"></a><span class="visited"> </span>
<a id="L19"></a><span > </span>
<a id="L20"></a><span > </span>
<a id="L21"></a><span > </span>
<a id="L22"></a><span > </span>
<a id="L23"></a><span > </span>
<a id="L24"></a><span > </span>
<a id="L25"></a><span > </span>
<a id="L26"></a><span > </span>
<a id="L27"></a><span > </span>
<a id="L28"></a><span > </span>
<a id="L29"></a><span > </span>
<a id="L30"></a><span > </span>
<a id="L31"></a><span > </span>
<a id="L32"></a><span > </span>
<a id="L33"></a><span > </span>
<a id="L34"></a><span > </span>
<a id="L35"></a><span > </span>
<a id="L36"></a><span > </span>
<a id="L37"></a><span class="visited"> </span>
<a id="L38"></a><span > </span>
<a id="L39"></a><span class="visited"> </span>
<a id="L40"></a><span > </span>
<a id="L41"></a><span class="visited"> </span>
<a id="L42"></a><span class="visited"> </span>
<a id="L43"></a><span > </span>
<a id="L44"></a><span class="visited"> </span>
<a id="L45"></a><span class="visited"> </span>
<a id="L46"></a><span class="visited"> </span>
<a id="L47"></a><span class="visited"> </span>
<a id="L48"></a><span class="visited"> </span>
<a id="L49"></a><span class="visited"> </span>
<a id="L50"></a><span class="visited"> </span>
<a id="L51"></a><span class="visited"> </span>
<a id="L52"></a><span class="visited"> </span>
<a id="L53"></a><span class="visited"> </span>
<a id="L54"></a><span class="visited"> </span>
<a id="L55"></a><span class="visited"> </span>
<a id="L56"></a><span class="visited"> </span>
<a id="L57"></a><span class="visited"> </span>
<a id="L58"></a><span class="unvisited"> </span>
<a id="L59"></a><span > </span>
<a id="L60"></a><span > </span>
<a id="L61"></a><span > </span>
<a id="L62"></a><span class="visited"> </span>
<a id="L63"></a><span > </span>
<a id="L64"></a><span class="visited"> </span>
<a id="L65"></a><span > </span>
<a id="L66"></a><span > </span>
<a id="L67"></a><span class="visited"> </span>
<a id="L68"></a><span class="visited"> </span>
<a id="L69"></a><span class="visited"> </span>
<a id="L70"></a><span class="visited"> </span>
<a id="L71"></a><span class="visited"> </span>
<a id="L72"></a><span > </span>
<a id="L73"></a><span > </span>
<a id="L74"></a><span class="visited"> </span>
<a id="L75"></a><span class="visited"> </span>
<a id="L76"></a><span class="visited"> </span>
<a id="L77"></a><span > </span>
<a id="L78"></a><span class="visited"> </span>
<a id="L79"></a><span class="visited"> </span>
<a id="L80"></a><span > </span>
<a id="L81"></a><span class="visited"> </span>
<a id="L82"></a><span > </span>
<a id="L83"></a><span class="visited"> </span>
<a id="L84"></a><span class="visited"> </span>
<a id="L85"></a><span > </span>
<a id="L86"></a><span class="visited"> </span>
<a id="L87"></a><span > </span>
<a id="L88"></a><span > </span>
<a id="L89"></a><span class="visited"> </span>
<a id="L90"></a><span > </span>
<a id="L91"></a><span > </span>
<a id="L92"></a><span > </span>
<a id="L93"></a><span class="visited"> </span>
<a id="L94"></a><span > </span>
<a id="L95"></a><span class="visited"> </span>
<a id="L96"></a><span > </span>
<a id="L97"></a><span > </span>
<a id="L98"></a><span > </span>
<a id="L99"></a><span > </span>
<a id="L100"></a><span > </span>
<a id="L101"></a><span class="visited"> </span>
<a id="L102"></a><span > </span>
<a id="L103"></a><span class="visited"> </span>
<a id="L104"></a><span class="visited"> </span>
<a id="L105"></a><span class="visited"> </span>
<a id="L106"></a><span class="visited"> </span>
<a id="L107"></a><span class="visited"> </span>
<a id="L108"></a><span class="visited"> </span>
<a id="L109"></a><span class="visited"> </span>
<a id="L110"></a><span class="visited"> </span>
<a id="L111"></a><span class="visited"> </span>
<a id="L112"></a><span class="visited"> </span>
<a id="L113"></a><span class="visited"> </span>
<a id="L114"></a><span class="visited"> </span>
<a id="L115"></a><span class="visited"> </span>
<a id="L116"></a><span class="visited"> </span>
<a id="L117"></a><span class="visited"> </span>
<a id="L118"></a><span class="visited"> </span>
<a id="L119"></a><span class="visited"> </span>
<a id="L120"></a><span class="visited"> </span>
<a id="L121"></a><span class="visited"> </span>
<a id="L122"></a><span class="visited"> </span>
<a id="L123"></a><span class="unvisited"> </span>
<a id="L124"></a><span class="unvisited"> </span>
<a id="L125"></a><span class="unvisited"> </span>
<a id="L126"></a><span class="unvisited"> </span>
<a id="L127"></a><span class="visited"> </span>
<a id="L128"></a><span class="visited"> </span>
<a id="L129"></a><span class="unvisited"> </span>
<a id="L130"></a><span class="unvisited"> </span>
<a id="L131"></a><span > </span>
<a id="L132"></a><span class="unvisited"> </span>
<a id="L133"></a><span class="unvisited"> </span>
<a id="L134"></a><span class="unvisited"> </span>
<a id="L135"></a><span class="unvisited"> </span>
<a id="L136"></a><span class="unvisited"> </span>
<a id="L137"></a><span class="unvisited"> </span>
<a id="L138"></a><span class="visited"> </span>
<a id="L139"></a><span class="visited"> </span>
<a id="L140"></a><span > </span>
<a id="L141"></a><span > </span>
<a id="L142"></a><span > </span>
<a id="L143"></a><span class="visited"> </span>
<a id="L144"></a><span > </span>
<a id="L145"></a><span > </span>
<a id="L146"></a><span class="visited"> </span>
<a id="L147"></a><span class="visited"> </span>
<a id="L148"></a><span > </span>
<a id="L149"></a><span > </span>
<a id="L150"></a><span > </span>
<a id="L151"></a><span class="visited"> </span>
<a id="L152"></a><span class="visited"> </span>
<a id="L153"></a><span class="visited"> </span>
<a id="L154"></a><span class="visited"> </span>
<a id="L155"></a><span class="visited"> </span>
<a id="L156"></a><span class="visited"> </span>
<a id="L157"></a><span > </span>
<a id="L158"></a><span class="visited"> </span>
<a id="L159"></a><span > </span>
<a id="L160"></a><span > </span>
<a id="L161"></a><span class="visited"> </span>
<a id="L162"></a><span class="visited"> </span>
<a id="L163"></a><span class="visited"> </span>
<a id="L164"></a><span class="visited"> </span>
<a id="L165"></a><span > </span>
<a id="L166"></a><span class="visited"> </span>
<a id="L167"></a><span > </span>
<a id="L168"></a><span class="visited"> </span>
<a id="L169"></a><span > </span>
<a id="L170"></a><span > </span>
<a id="L171"></a><span class="visited"> </span>
<a id="L172"></a><span > </span>
<a id="L173"></a><span class="visited"> </span>
<a id="L174"></a><span > </span>
<a id="L175"></a><span class="visited"> </span>
<a id="L176"></a><span > </span>
<a id="L177"></a><span > </span>
<a id="L178"></a><span class="visited"> </span>
<a id="L179"></a><span class="visited"> </span>
<a id="L180"></a><span class="visited"> </span>
<a id="L181"></a><span > </span>
<a id="L182"></a><span > </span>
<a id="L183"></a><span class="visited"> </span>
<a id="L184"></a><span class="visited"> </span>
<a id="L185"></a><span class="visited"> </span>
<a id="L186"></a><span class="visited"> </span>
<a id="L187"></a><span > </span>
<a id="L188"></a><span class="visited"> </span>
<a id="L189"></a><span class="visited"> </span>
<a id="L190"></a><span class="visited"> </span>
<a id="L191"></a><span class="visited"> </span>
<a id="L192"></a><span class="visited"> </span>
<a id="L193"></a><span class="visited"> </span>
<a id="L194"></a><span class="visited"> </span>
<a id="L195"></a><span class="visited"> </span>
<a id="L196"></a><span class="visited"> </span>
<a id="L197"></a><span class="visited"> </span>
<a id="L198"></a><span > </span>
<a id="L199"></a><span > </span>
<a id="L200"></a><span class="visited"> </span>
<a id="L201"></a><span > </span>
<a id="L202"></a><span > </span>
<a id="L203"></a><span class="visited"> </span>
<a id="L204"></a><span > </span>
<a id="L205"></a><span class="visited"> </span>
<a id="L206"></a><span > </span>
<a id="L207"></a><span > </span>
<a id="L208"></a><span class="unvisited"> </span>
<a id="L209"></a><span class="visited"> </span>
<a id="L210"></a><span class="visited"> </span>
<a id="L211"></a><span class="visited"> </span>
<a id="L212"></a><span > </span>
<a id="L213"></a><span class="visited"> </span>
<a id="L214"></a><span class="visited"> </span>
<a id="L215"></a><span class="visited"> </span>
<a id="L216"></a><span class="visited"> </span>
<a id="L217"></a><span class="visited"> </span>
<a id="L218"></a><span class="visited"> </span>
<a id="L219"></a><span class="visited"> </span>
<a id="L220"></a><span > </span>
<a id="L221"></a><span > </span>
</pre>
      </div>
      <div id="text-layer">
        <pre id="line-numbers">
<a href="#L1">  1</a>
<a href="#L2">  2</a>
<a href="#L3">  3</a>
<a href="#L4">  4</a>
<a href="#L5">  5</a>
<a href="#L6">  6</a>
<a href="#L7">  7</a>
<a href="#L8">  8</a>
<a href="#L9">  9</a>
<a href="#L10"> 10</a>
<a href="#L11"> 11</a>
<a href="#L12"> 12</a>
<a href="#L13"> 13</a>
<a href="#L14"> 14</a>
<a href="#L15"> 15</a>
<a href="#L16"> 16</a>
<a href="#L17"> 17</a>
<a href="#L18"> 18</a>
<a href="#L19"> 19</a>
<a href="#L20"> 20</a>
<a href="#L21"> 21</a>
<a href="#L22"> 22</a>
<a href="#L23"> 23</a>
<a href="#L24"> 24</a>
<a href="#L25"> 25</a>
<a href="#L26"> 26</a>
<a href="#L27"> 27</a>
<a href="#L28"> 28</a>
<a href="#L29"> 29</a>
<a href="#L30"> 30</a>
<a href="#L31"> 31</a>
<a href="#L32"> 32</a>
<a href="#L33"> 33</a>
<a href="#L34"> 34</a>
<a href="#L35"> 35</a>
<a href="#L36"> 36</a>
<a href="#L37"> 37</a>
<a href="#L38"> 38</a>
<a href="#L39"> 39</a>
<a href="#L40"> 40</a>
<a href="#L41"> 41</a>
<a href="#L42"> 42</a>
<a href="#L43"> 43</a>
<a href="#L44"> 44</a>
<a href="#L45"> 45</a>
<a href="#L46"> 46</a>
<a href="#L47"> 47</a>
<a href="#L48"> 48</a>
<a href="#L49"> 49</a>
<a href="#L50"> 50</a>
<a href="#L51"> 51</a>
<a href="#L52"> 52</a>
<a href="#L53"> 53</a>
<a href="#L54"> 54</a>
<a href="#L55"> 55</a>
<a href="#L56"> 56</a>
<a href="#L57"> 57</a>
<a href="#L58"> 58</a>
<a href="#L59"> 59</a>
<a href="#L60"> 60</a>
<a href="#L61"> 61</a>
<a href="#L62"> 62</a>
<a href="#L63"> 63</a>
<a href="#L64"> 64</a>
<a href="#L65"> 65</a>
<a href="#L66"> 66</a>
<a href="#L67"> 67</a>
<a href="#L68"> 68</a>
<a href="#L69"> 69</a>
<a href="#L70"> 70</a>
<a href="#L71"> 71</a>
<a href="#L72"> 72</a>
<a href="#L73"> 73</a>
<a href="#L74"> 74</a>
<a href="#L75"> 75</a>
<a href="#L76"> 76</a>
<a href="#L77"> 77</a>
<a href="#L78"> 78</a>
<a href="#L79"> 79</a>
<a href="#L80"> 80</a>
<a href="#L81"> 81</a>
<a href="#L82"> 82</a>
<a href="#L83"> 83</a>
<a href="#L84"> 84</a>
<a href="#L85"> 85</a>
<a href="#L86"> 86</a>
<a href="#L87"> 87</a>
<a href="#L88"> 88</a>
<a href="#L89"> 89</a>
<a href="#L90"> 90</a>
<a href="#L91"> 91</a>
<a href="#L92"> 92</a>
<a href="#L93"> 93</a>
<a href="#L94"> 94</a>
<a href="#L95"> 95</a>
<a href="#L96"> 96</a>
<a href="#L97"> 97</a>
<a href="#L98"> 98</a>
<a href="#L99"> 99</a>
<a href="#L100">100</a>
<a href="#L101">101</a>
<a href="#L102">102</a>
<a href="#L103">103</a>
<a href="#L104">104</a>
<a href="#L105">105</a>
<a href="#L106">106</a>
<a href="#L107">107</a>
<a href="#L108">108</a>
<a href="#L109">109</a>
<a href="#L110">110</a>
<a href="#L111">111</a>
<a href="#L112">112</a>
<a href="#L113">113</a>
<a href="#L114">114</a>
<a href="#L115">115</a>
<a href="#L116">116</a>
<a href="#L117">117</a>
<a href="#L118">118</a>
<a href="#L119">119</a>
<a href="#L120">120</a>
<a href="#L121">121</a>
<a href="#L122">122</a>
<a href="#L123">123</a>
<a href="#L124">124</a>
<a href="#L125">125</a>
<a href="#L126">126</a>
<a href="#L127">127</a>
<a href="#L128">128</a>
<a href="#L129">129</a>
<a href="#L130">130</a>
<a href="#L131">131</a>
<a href="#L132">132</a>
<a href="#L133">133</a>
<a href="#L134">134</a>
<a href="#L135">135</a>
<a href="#L136">136</a>
<a href="#L137">137</a>
<a href="#L138">138</a>
<a href="#L139">139</a>
<a href="#L140">140</a>
<a href="#L141">141</a>
<a href="#L142">142</a>
<a href="#L143">143</a>
<a href="#L144">144</a>
<a href="#L145">145</a>
<a href="#L146">146</a>
<a href="#L147">147</a>
<a href="#L148">148</a>
<a href="#L149">149</a>
<a href="#L150">150</a>
<a href="#L151">151</a>
<a href="#L152">152</a>
<a href="#L153">153</a>
<a href="#L154">154</a>
<a href="#L155">155</a>
<a href="#L156">156</a>
<a href="#L157">157</a>
<a href="#L158">158</a>
<a href="#L159">159</a>
<a href="#L160">160</a>
<a href="#L161">161</a>
<a href="#L162">162</a>
<a href="#L163">163</a>
<a href="#L164">164</a>
<a href="#L165">165</a>
<a href="#L166">166</a>
<a href="#L167">167</a>
<a href="#L168">168</a>
<a href="#L169">169</a>
<a href="#L170">170</a>
<a href="#L171">171</a>
<a href="#L172">172</a>
<a href="#L173">173</a>
<a href="#L174">174</a>
<a href="#L175">175</a>
<a href="#L176">176</a>
<a href="#L177">177</a>
<a href="#L178">178</a>
<a href="#L179">179</a>
<a href="#L180">180</a>
<a href="#L181">181</a>
<a href="#L182">182</a>
<a href="#L183">183</a>
<a href="#L184">184</a>
<a href="#L185">185</a>
<a href="#L186">186</a>
<a href="#L187">187</a>
<a href="#L188">188</a>
<a href="#L189">189</a>
<a href="#L190">190</a>
<a href="#L191">191</a>
<a href="#L192">192</a>
<a href="#L193">193</a>
<a href="#L194">194</a>
<a href="#L195">195</a>
<a href="#L196">196</a>
<a href="#L197">197</a>
<a href="#L198">198</a>
<a href="#L199">199</a>
<a href="#L200">200</a>
<a href="#L201">201</a>
<a href="#L202">202</a>
<a href="#L203">203</a>
<a href="#L204">204</a>
<a href="#L205">205</a>
<a href="#L206">206</a>
<a href="#L207">207</a>
<a href="#L208">208</a>
<a href="#L209">209</a>
<a href="#L210">210</a>
<a href="#L211">211</a>
<a href="#L212">212</a>
<a href="#L213">213</a>
<a href="#L214">214</a>
<a href="#L215">215</a>
<a href="#L216">216</a>
<a href="#L217">217</a>
<a href="#L218">218</a>
<a href="#L219">219</a>
<a href="#L220">220</a>
<a href="#L221">221</a>
</pre>
<pre><code class="ocaml">open Mo_types
open Ir_def

module E = Env
open Source
module Ir = Ir
open Ir
module T = Type
open T

(* Erase type fields from object types *)

module ConRenaming = E.Make(struct type t = T.con let compare = Cons.compare end)

let transform prog =

  (* the state *)
  <span data-count="857">l</span>et con_renaming = ref ConRenaming.empty

  (* maps constructors to new constructors (name name, new stamp, new kind)
     it is initialized with the type constructors defined outside here, which are
     not rewritten.

     If we run this translation on two program fragments (e.g. prelude and program)
     we would have to pass down the `con_renaming`. But this is simply the right thing
     to do for a pass that changes the context.

     Eventually, pipeline will allow us to pass the con_renaming to downstream program
     fragments, then we would simply start with an empty con_renaming and the prelude.

     (c.f. async.ml.)
  *)
  in

  (* Mostly boiler-plate homomorphic translation *)
  let rec t_typ t =
    <span data-count="13874366">m</span>atch t with
    (* The only interesting case *)
    | <span data-count="302153">O</span>bj (s, fs) -&gt;
      Obj (s,
        List.filter_ma<span data-count="302153">p</span> (fun f -&gt;
          <span data-count="3043159">i</span>f is_typ f.typ then <span data-count="243622">N</span>one else <span data-count="2799537">S</span>ome (t_fiel<span data-count="2799537">d</span> f))
        fs)
    | <span data-count="1065878">T</span>.Prim _
    | <span data-count="359418">V</span>ar _ -&gt; t
    | <span data-count="6672065">C</span>on (c, ts) -&gt;
      Con (t_co<span data-count="6672065">n</span> c, List.ma<span data-count="6672065">p</span> t_typ ts)
    | <span data-count="301702">A</span>rray t -&gt; Array (t_ty<span data-count="301702">p</span> t)
    | <span data-count="589397">T</span>up ts -&gt; Tup (List.ma<span data-count="589397">p</span> t_typ ts)
    | <span data-count="2841576">F</span>unc (s, c, tbs, ts1, ts2) -&gt;
      Func (s, c, List.ma<span data-count="2841576">p</span> t_bind tbs, List.ma<span data-count="2841576">p</span> t_typ ts1, List.ma<span data-count="2841576">p</span> t_typ ts2)
    | <span data-count="788590">O</span>pt t -&gt; Opt (t_ty<span data-count="788590">p</span> t)
    | <span data-count="66159">V</span>ariant fs -&gt; Variant (List.ma<span data-count="66159">p</span> t_field fs)
    | <span data-count="209584">A</span>sync (s, t1, t2) -&gt; Async (s, t_ty<span data-count="209584">p</span> t1, t_ty<span data-count="209584">p</span> t2)
    | <span data-count="265311">M</span>ut t -&gt; Mut (t_ty<span data-count="265311">p</span> t)
    | <span data-count="390932">A</span>ny -&gt; Any
    | <span data-count="21601">N</span>on -&gt; Non
    | <span data-count="0">P</span>re -&gt; Pre
    | Typ c -&gt; assert false (* second class *)

  and t_bind tb =
    <span data-count="325824">{</span> tb with bound = t_ty<span data-count="325824">p</span> tb.bound }

  and t_binds typbinds = <span data-count="37456">L</span>ist.map t_bind typbinds

  and t_kind k =
    <span data-count="37456">m</span>atch k with
    | <span data-count="27967">T</span>.Abs (typ_binds,typ) -&gt;
      T.Abs (t_bind<span data-count="27967">s</span> typ_binds, t_ty<span data-count="27967">p</span> typ)
    | <span data-count="9489">T</span>.Def (typ_binds,typ) -&gt;
      T.Def (t_bind<span data-count="9489">s</span> typ_binds, t_ty<span data-count="9489">p</span> typ)

  and t_con c =
    <span data-count="6700122">m</span>atch Cons.kind c with
    | <span data-count="5780458">T</span>.Def ([], T.Prim _) -&gt; c
    | <span data-count="919664">_</span> -&gt;
      match  ConRenaming.find_opt c (!con_renaming) with
      | <span data-count="882208">S</span>ome c' -&gt; c'
      | <span data-count="37456">N</span>one -&gt;
        let clone = Cons.clone c (Abs ([], Pre)) in
        <span data-count="37456">c</span>on_renaming := ConRenaming.ad<span data-count="37456">d</span> c clone (!con_renaming);
        (* Need to extend con_renaming before traversing the kind *)
        Type.set_kind clone (t_kin<span data-count="37456">d</span> (Cons.kin<span data-count="37456">d</span> c));
        <span data-count="37456">c</span>lone

  and t_prim p = <span data-count="563658">I</span>r.map_prim t_typ (fun id -&gt; <span data-count="7699">i</span>d) p

  and t_field {lab; typ; src} =
    <span data-count="2965298">{</span> lab; typ = t_ty<span data-count="2965298">p</span> typ; src }
  in

  let rec t_exp (exp : exp) =
    <span data-count="1672103">{</span> it = t_exp<span data-count="1672103">'</span> exp;
      note = Note.{ def with
        typ = t_ty<span data-count="1672103">p</span> exp.note.typ;
        eff = exp.note.eff
      };
      at = exp.at;
    }
  and t_exp' (exp : exp) =
    <span data-count="1672103">l</span>et exp' = exp.it in
    match exp' with
    | <span data-count="158412">L</span>itE _ -&gt; exp'
    | <span data-count="540428">V</span>arE id -&gt; exp'
    | <span data-count="47101">A</span>ssignE (exp1, exp2) -&gt;
      AssignE (t_lex<span data-count="47101">p</span> exp1, t_ex<span data-count="47101">p</span> exp2)
    | <span data-count="563658">P</span>rimE (p, exps) -&gt;
      PrimE (t_pri<span data-count="563658">m</span> p, List.ma<span data-count="563658">p</span> t_exp exps)
    | <span data-count="72584">B</span>lockE b -&gt;
      BlockE (t_bloc<span data-count="72584">k</span> b)
    | <span data-count="39458">I</span>fE (exp1, exp2, exp3) -&gt;
      IfE (t_ex<span data-count="39458">p</span> exp1, t_ex<span data-count="39458">p</span> exp2, t_ex<span data-count="39458">p</span> exp3)
    | <span data-count="17189">S</span>witchE (exp1, cases) -&gt;
      SwitchE (t_ex<span data-count="17189">p</span> exp1, List.ma<span data-count="17189">p</span> t_case cases)
    | <span data-count="7299">L</span>oopE exp1 -&gt;
      LoopE (t_ex<span data-count="7299">p</span> exp1)
    | <span data-count="7749">L</span>abelE (id, typ, exp1) -&gt;
      LabelE (id, t_ty<span data-count="7749">p</span> typ, t_ex<span data-count="7749">p</span> exp1)
    | <span data-count="6404">A</span>syncE (s, tb, exp1, typ) -&gt;
      AsyncE (s, t_typ_bin<span data-count="6404">d</span> tb, t_ex<span data-count="6404">p</span> exp1, t_ty<span data-count="6404">p</span> typ)
    | <span data-count="429">T</span>ryE (exp1, cases) -&gt;
      TryE (t_ex<span data-count="429">p</span> exp1, List.ma<span data-count="429">p</span> t_case cases)
    | <span data-count="0">D</span>eclareE (id, typ, exp1) -&gt;
      DeclareE (id, t_ty<span data-count="0">p</span> typ, t_ex<span data-count="0">p</span> exp1)
    | <span data-count="0">D</span>efineE (id, mut ,exp1) -&gt;
      DefineE (id, mut, t_ex<span data-count="0">p</span> exp1)
    | <span data-count="189637">F</span>uncE (x, s, c, typbinds, args, ret_tys, exp) -&gt;
      FuncE (x, s, c, t_typ_bind<span data-count="189637">s</span> typbinds, t_arg<span data-count="189637">s</span> args, List.ma<span data-count="189637">p</span> t_typ ret_tys, t_ex<span data-count="189637">p</span> exp)
    | <span data-count="0">A</span>ctorE (ds, fs, {meta; preupgrade; postupgrade; heartbeat; timer; inspect}, typ) -&gt;
      ActorE (t_dec<span data-count="0">s</span> ds, t_field<span data-count="0">s</span> fs,
       {meta;
        preupgrade = t_ex<span data-count="0">p</span> preupgrade;
        postupgrade = t_ex<span data-count="0">p</span> postupgrade;
        heartbeat = t_ex<span data-count="0">p</span> heartbeat;
        timer = t_ex<span data-count="0">p</span> timer;
        inspect = t_ex<span data-count="0">p</span> inspect;
       }, t_ty<span data-count="0">p</span> typ)
    | <span data-count="21755">N</span>ewObjE (sort, ids, t) -&gt;
      NewObjE (sort, t_field<span data-count="21755">s</span> ids, t_ty<span data-count="21755">p</span> t)
    | SelfCallE _ -&gt; assert false

  and t_case {it = {pat; exp}; at; note} =
    <span data-count="39407">{</span> it = {pat = t_pa<span data-count="39407">t</span> pat; exp = t_ex<span data-count="39407">p</span> exp}; at; note}

  and t_lexp lexp =
    <span data-count="47103">{</span> it = t_lexp<span data-count="47103">'</span> lexp.it;
      note = t_ty<span data-count="47103">p</span> lexp.note;
      at = lexp.at;
    }
  and t_lexp' (lexp' : lexp') =
    <span data-count="47103">m</span>atch lexp' with
    | <span data-count="43502">V</span>arLE _ -&gt; lexp'
    | <span data-count="40">D</span>otLE (exp1, id) -&gt;
      DotLE (t_ex<span data-count="40">p</span> exp1, id)
    | <span data-count="3561">I</span>dxLE (exp1, exp2) -&gt;
      IdxLE (t_ex<span data-count="3561">p</span> exp1, t_ex<span data-count="3561">p</span> exp2)

  and t_dec dec = <span data-count="401817">{</span> dec with it = t_dec<span data-count="401817">'</span> dec.it }

  and t_dec' dec' =
    <span data-count="401817">m</span>atch dec' with
    | <span data-count="377022">L</span>etD (pat,exp) -&gt; LetD (t_pa<span data-count="377022">t</span> pat,t_ex<span data-count="377022">p</span> exp)
    | <span data-count="24793">V</span>arD (id, t, exp) -&gt; VarD (id, t_ty<span data-count="24793">p</span> t, t_ex<span data-count="24793">p</span> exp)
    | <span data-count="2">R</span>efD (id, t, lexp) -&gt; RefD (id, t_ty<span data-count="2">p</span> t, t_lex<span data-count="2">p</span> lexp)

  and t_decs decs = <span data-count="73441">L</span>ist.map t_dec decs

  and t_block (ds, exp) = <span data-count="72584">(</span>t_dec<span data-count="72584">s</span> ds, t_ex<span data-count="72584">p</span> exp)

  and t_fields fs =
    <span data-count="22265">L</span>ist.map (fun f -&gt; <span data-count="179506">{</span> f with note = t_ty<span data-count="179506">p</span> f.note }) fs

  and t_args as_ = <span data-count="189688">L</span>ist.map t_arg as_

  and t_arg a = <span data-count="208023">{</span> a with note = t_ty<span data-count="208023">p</span> a.note }

  and t_pat pat =
    <span data-count="463793">{</span> pat with
      it = t_pat<span data-count="463793">'</span> pat.it;
      note = t_ty<span data-count="463793">p</span> pat.note }

  and t_pat' pat =
    <span data-count="463793">m</span>atch pat with
    | <span data-count="77675">W</span>ildP
    | <span data-count="21618">L</span>itP _
    | <span data-count="328295">V</span>arP _ -&gt;
      pat
    | <span data-count="6416">T</span>upP pats -&gt;
      TupP (List.ma<span data-count="6416">p</span> t_pat pats)
    | <span data-count="2774">O</span>bjP pfs -&gt;
      ObjP (map_obj_pa<span data-count="2774">t</span> t_pat pfs)
    | <span data-count="17625">O</span>ptP pat1 -&gt;
      OptP (t_pa<span data-count="17625">t</span> pat1)
    | <span data-count="5917">T</span>agP (i, pat1) -&gt;
      TagP (i, t_pa<span data-count="5917">t</span> pat1)
    | <span data-count="3473">A</span>ltP (pat1, pat2) -&gt;
      AltP (t_pa<span data-count="3473">t</span> pat1, t_pa<span data-count="3473">t</span> pat2)

  and t_typ_bind' tb =
    <span data-count="28057">{</span> tb with con = t_co<span data-count="28057">n</span> tb.con; bound = t_ty<span data-count="28057">p</span> tb.bound }

  and t_typ_bind typ_bind =
    <span data-count="28057">{</span> typ_bind with it = t_typ_bind<span data-count="28057">'</span> typ_bind.it }

  and t_typ_binds typbinds = <span data-count="189637">L</span>ist.map t_typ_bind typbinds

  and t_comp_unit = function
    | <span data-count="0">L</span>ibU _ -&gt; raise (Invalid_argument "cannot compile library")
    | <span data-count="347">P</span>rogU ds -&gt; ProgU (t_dec<span data-count="347">s</span> ds)
    | <span data-count="510">A</span>ctorU (args_opt, ds, fs, {meta; preupgrade; postupgrade; heartbeat; timer; inspect}, t) -&gt;
      ActorU (Option.ma<span data-count="510">p</span> t_args args_opt, t_dec<span data-count="510">s</span> ds, t_field<span data-count="510">s</span> fs,
        { meta;
          preupgrade = t_ex<span data-count="510">p</span> preupgrade;
          postupgrade = t_ex<span data-count="510">p</span> postupgrade;
          heartbeat = t_ex<span data-count="510">p</span> heartbeat;
          timer = t_ex<span data-count="510">p</span> timer;
          inspect = t_ex<span data-count="510">p</span> inspect;
        }, t_ty<span data-count="510">p</span> t)
  and t_prog (cu, flavor) = <span data-count="857">(</span>t_comp_uni<span data-count="857">t</span> cu, { flavor with has_typ_field = false } )
in
  t_prog prog
</code></pre>
      </div>
    </div>
    <script src="../coverage.js"></script>
  </body>
</html>
