<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>md/actor-classes.md</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">md/actor-classes.md</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#actor-classes" id="toc-actor-classes">Actor classes</a>
<ul>
<li><a href="#configuring-and-managing-actor-class-instances"
id="toc-configuring-and-managing-actor-class-instances">Configuring and
managing actor class instances</a></li>
</ul></li>
</ul>
</nav>
<h1 id="actor-classes">Actor classes</h1>
<p>Actor classes enable you to create networks of actors (canister smart
contracts) <em>programmatically</em>. Currently, actor classes have to
be defined in a separate source file. To illustrate how to define and
import actor classes, the following example implements a distributed map
of keys of type <code>Nat</code> to values of type <code>Text</code>. It
provides simple insert and lookup functions, <code>put(k, v)</code> and
<code>get(k)</code>, for working with these keys and values.</p>
<p>To distribute the data for this example, the set of keys is
partitioned into <code>n</code> buckets. For now, we just fix
<code>n = 8</code>. The bucket, <code>i</code>, of a key,
<code>k</code>, is determined by the remainder of <code>k</code> divided
by <code>n</code>, that is, <code>i = k % n</code>. The <code>i</code>th
bucket (<code>i</code> in <code>[0..n)</code>) receives a dedicated
actor to store text values assigned to keys in that bucket.</p>
<p>The actor responsible for bucket <code>i</code> is obtained as an
instance of the actor class <code>Bucket(i)</code>, defined in the
sample <code>Buckets.mo</code> file, as follows:</p>
<p><code>Buckets.mo</code>:</p>
<pre class="motoko"><code></code></pre>
<p>A bucket stores the current mapping of keys to values in a mutable
<code>map</code> variable containing an imperative RedBlack tree,
<code>map</code>, that is initially empty.</p>
<p>On <code>get(k)</code>, the bucket actor simply returns any value
stored at <code>k</code>, returning <code>map.get(k)</code>.</p>
<p>On <code>put(k, v)</code>, the bucket actor updates the current
<code>map</code> to map <code>k</code> to <code>?v</code> by calling
<code>map.put(k, v)</code>.</p>
<p>Both functions use the class parameters <code>n</code> and
<code>i</code> to verify that the key is appropriate for the bucket by
asserting <code>((k % n) == i)</code>.</p>
<p>Clients of the map can then communicate with a coordinating
<code>Map</code> actor, implemented as follows:</p>
<pre class="motoko"><code></code></pre>
<p>As this example illustrates, the <code>Map</code> code imports the
<code>Bucket</code> actor class as module <code>Buckets</code>.</p>
<p>The actor maintains an array of <code>n</code> allocated buckets,
with all entries initially <code>null</code>. Entries are populated with
<code>Bucket</code> actors on demand.</p>
<p>On <code>get(k, v)</code>, the <code>Map</code> actor:</p>
<ul>
<li><p>uses the remainder of key <code>k</code> divided by
<code>n</code> to determine the index <code>i</code> of the bucket
responsible for that key</p></li>
<li><p>returns <code>null</code> if the <code>i</code>th bucket does not
exist, or</p></li>
<li><p>delegates to that bucket by calling <code>bucket.get(k, v)</code>
if it does.</p></li>
</ul>
<p>On <code>put(k, v)</code>, the <code>Map</code> actor:</p>
<ul>
<li><p>uses the remainder of key <code>k</code> divided by
<code>n</code> to determine the index <code>i</code> of the bucket
responsible for that key</p></li>
<li><p>installs bucket <code>i</code> if the bucket does not exist by
using an asynchronous call to the constructor,
<code>Buckets.Bucket(i)</code>, and, after awaiting the result, records
it in the array <code>buckets</code></p></li>
<li><p>delegates the insertion to that bucket by calling
<code>bucket.put(k, v)</code>.</p></li>
</ul>
<p>While this example sets the number of buckets to <code>8</code>, you
can easily generalize the example by making the <code>Map</code> actor
an actor <em>class</em>, adding a parameter <code>(n : Nat)</code> and
omitting the declaration <code>let n = 8;</code>. For example:</p>
<pre class="motoko"><code>actor class Map(n : Nat) {

  type Key = Nat
  ...
}</code></pre>
<p>Clients of actor <em>class</em> <code>Map</code> are now free to
determine the (maximum) number of buckets in the network by passing an
argument on construction.</p>
<p>:::note</p>
<p>On the Internet Computer, calls to a class constructor must be
provisioned with cycles to pay for the creation of a principal. See <a
href="./base/ExperimentalCycles.md">ExperimentalCycles</a> for
instructions on how to add cycles to a call using the imperative
<code>ExperimentalCycles.add(cycles)</code> function.</p>
<p>:::</p>
<h2 id="configuring-and-managing-actor-class-instances">Configuring and
managing actor class instances</h2>
<p>On the Internet Computer, the primary constructor of an imported
actor class always creates a new principal and installs a fresh instance
of the class as the code for that principal.</p>
<p>To provide further control over actor class installation, Motoko
endows each imported actor class with an extra, secondary constructor.
This constructor takes an additional first argument that specifies the
desired installation mode. The constructor is only available via special
syntax that stresses its <code>system</code> functionality.</p>
<p>Using this syntax, it's possible to specify initial canister settings
(such as an array of controllers), manually install, upgrade and
reinstall canisters, exposing all of the lower-level facilities of the
Internet Computer.</p>
<p>See <a href="language-manual.md#actor-class-management">Actor class
management</a> for more details.</p>
</body>
</html>
